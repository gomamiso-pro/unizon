click="document.getElementById('prizeInput').click()">
                <input type="file" id="prizeInput" accept="image/*" style="display:none;">
                <img id="prize-image" src="" alt="å•†å“ç”»åƒ" style="display: none;">
                <p id="prize-prompt">ã‚¿ãƒƒãƒ—ã—ã¦å•†å“å†™çœŸã‚’é¸ã¶ï¼ˆã‚«ãƒ¡ãƒ©/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰</p>
            </div>

            <h3>â‘¡ å‚åŠ è€…ã‚’ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆã‚¿ãƒƒãƒ—ã§é¸æŠï¼‰</h3>
            <div id="member-selection-area">
                <p>å‚åŠ ãƒ¡ãƒ³ãƒãƒ¼ï¼š<span id="selected-count">0</span>äºº</p>
                <div id="member-grid">
                    <p id="loading-members">ãƒ¡ãƒ³ãƒãƒ¼ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
            </div>
            
            <div id="result-container">
                <img id="result-image" src="" alt="å½“é¸è€…ç”»åƒ">
                <div id="result-name">---</div>
            </div>
            
            <button id="kujibiki-button" onclick="startKujibiki()" disabled>ãã˜ã‚’å¼•ãï¼</button>

            <p style="margin-top: 20px;">â€» å‚åŠ è€…ã‚’1äººä»¥ä¸Šé¸ã‚“ã§ãã ã•ã„ã€‚</p>

        </section>
    </main>

    <script>
        // --- ãã˜å¼•ãã®ãƒ­ã‚¸ãƒƒã‚¯ ---
        
        // â˜… ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã‚¢ãƒ—ãƒªã¨åŒã˜API URLã‚’è¨­å®š â˜…
        const API_URL = "https://script.google.com/macros/s/AKfycbzROz8hBY31FZB0cECHPXF6DJlX2t8t3rOAHaOBAfWE3M4jYiyw6u3TWG3N0WxPbGFM/exec";
        
        // â˜…â˜…â˜… GitHubã®ç”»åƒä¿å­˜ãƒ•ã‚©ãƒ«ãƒ€ã®URL â˜…â˜…â˜…
        const GITHUB_BASE_URL = "https://raw.githubusercontent.com/gomamiso-pro/unizon/main/images/member/";
        
        const DEFAULT_IMAGE_PATH = GITHUB_BASE_URL + '00.png';

        let membersData = []; // å…¨ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´
        let selectedMembers = []; // æŠ½é¸ã«å‚åŠ ã™ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ã‚’æ ¼ç´
        
        // DOMè¦ç´ ã®å–å¾—
        const RESULT_IMAGE = document.getElementById('result-image');
        const RESULT_NAME = document.getElementById('result-name');
        const BUTTON = document.getElementById('kujibiki-button');
        const LOADING_MESSAGE = document.getElementById('loading-message');
        const MEMBER_GRID = document.getElementById('member-grid');
        const SELECTED_COUNT = document.getElementById('selected-count');
        const PRIZE_INPUT = document.getElementById('prizeInput');
        const PRIZE_IMAGE = document.getElementById('prize-image');
        const PRIZE_PROMPT = document.getElementById('prize-prompt');
        
        let intervalId;

        // ------------------------------------
        // A. ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        // ------------------------------------

        // ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’éåŒæœŸã§èª­ã¿è¾¼ã‚€é–¢æ•°
        async function loadMembersForKujibiki() {
            LOADING_MESSAGE.textContent = "ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...";
            try {
                const res = await fetch(API_URL);
                const members = await res.json();

                if (Array.isArray(members) && members.length > 0) {
                    membersData = members.map(m => {
                        const memberNumber = String(m.number || '00').trim();
                        
                        // ç”»åƒãƒ‘ã‚¹ã‚’GitHub URLã«è¨­å®š
                        const imagePngUrl = GITHUB_BASE_URL + `${memberNumber}.png`;
                        const imageJpgUrl = GITHUB_BASE_URL + `${memberNumber}.jpg`;

                        return {
                            nickname: m.nickname,
                            // GASã‹ã‚‰æ¥ã‚‹ç”»åƒURLã‚’æœ€å„ªå…ˆ
                            image_gas: m.image,
                            // GitHubãƒ‘ã‚¹ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
                            image_png: imagePngUrl,
                            image_jpg: imageJpgUrl,
                            number: memberNumber
                        };
                    });
                    
                    displayMemberSelection(); // ãƒ¡ãƒ³ãƒãƒ¼é¸æŠã‚°ãƒªãƒƒãƒ‰ã‚’è¡¨ç¤º
                    LOADING_MESSAGE.textContent = ""; 
                    
                } else {
                    LOADING_MESSAGE.textContent = "ã‚¨ãƒ©ãƒ¼: ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã›ã‚“ã€‚";
                }
            } catch (err) {
                LOADING_MESSAGE.textContent = "ã‚¨ãƒ©ãƒ¼: ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
                console.error("ãƒ¡ãƒ³ãƒãƒ¼å–å¾—é€šä¿¡ã‚¨ãƒ©ãƒ¼:", err);
            }
        }
        
        // ------------------------------------
        // B. ãƒ¡ãƒ³ãƒãƒ¼é¸æŠæ©Ÿèƒ½
        // ------------------------------------

        // ãƒ¡ãƒ³ãƒãƒ¼é¸æŠã‚°ãƒªãƒƒãƒ‰ã‚’DOMã«è¡¨ç¤º
        function displayMemberSelection() {
            MEMBER_GRID.innerHTML = '';
            
            membersData.forEach(member => {
                const card = document.createElement('div');
                card.className = 'member-card';
                card.dataset.number = member.number;
                
                // ç”»åƒè¦ç´ ã®ç”Ÿæˆ
                const img = document.createElement('img');
                img.alt = member.nickname;
                
                // â˜… ç”»åƒã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ã®è¨­å®š (GAS/PNG/JPG/00.pngã®é †ã«è©¦ã™) â˜…
                let errorCount = 0;
                img.onerror = function() {
                    errorCount++;
                    
                    if (errorCount === 1) {
                        // 1å›ç›®ã‚¨ãƒ©ãƒ¼: GASã®URL ã¾ãŸã¯ .png ãŒå¤±æ•—
                        // æ¬¡ã« .jpg ã‚’è©¦ã™
                        this.src = member.image_jpg; 
                    } else if (errorCount === 2) {
                        // 2å›ç›®ã‚¨ãƒ©ãƒ¼: .jpg ã‚‚å¤±æ•—
                        this.src = DEFAULT_IMAGE_PATH; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 00.png ã‚’è©¦ã™
                    } else {
                        // 3å›ç›®ä»¥é™ã®ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–
                        this.onerror = null; 
                    }
                };

                // åˆæœŸã‚½ãƒ¼ã‚¹ã®è¨­å®šï¼ˆGAS/å¤–éƒ¨URLã‚’å„ªå…ˆã€ãªã‘ã‚Œã°GitHubã®.pngã‚’è©¦ã™ï¼‰
                img.src = member.image_gas || member.image_png;

                card.appendChild(img);
                
                const p = document.createElement('p');
                p.textContent = member.nickname;
                card.appendChild(p);

                // ã‚¿ãƒƒãƒ—ã§é¸æŠ/è§£é™¤
                card.addEventListener('click', () => toggleMemberSelection(member, card));
                
                MEMBER_GRID.appendChild(card);
            });
            
            const loadingMsgElement = document.getElementById('loading-members');
            if(loadingMsgElement) loadingMsgElement.style.display = 'none'; 
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ã®é¸æŠ/è§£é™¤
        function toggleMemberSelection(member, cardElement) {
            const index = selectedMembers.findIndex(m => m.number === member.number);
            
            if (index === -1) {
                selectedMembers.push(member);
                cardElement.classList.add('selected');
            } else {
                selectedMembers.splice(index, 1);
                cardElement.classList.remove('selected');
            }

            SELECTED_COUNT.textContent = selectedMembers.length;
            checkButtonState();
        }
        
        // ------------------------------------
        // C. å•†å“ç”»åƒæ©Ÿèƒ½
        // ------------------------------------
        
        PRIZE_INPUT.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    PRIZE_IMAGE.src = e.target.result;
                    PRIZE_IMAGE.style.display = 'block';
                    PRIZE_PROMPT.textContent = 'å•†å“ç”»åƒã‚’è¨­å®šã—ã¾ã—ãŸ';
                };
                reader.readAsDataURL(file);
            } else {
                PRIZE_IMAGE.style.display = 'none';
                PRIZE_PROMPT.textContent = 'ã‚¿ãƒƒãƒ—ã—ã¦å•†å“å†™çœŸã‚’é¸ã¶ï¼ˆã‚«ãƒ¡ãƒ©/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰';
            }
        });

        // ------------------------------------
        // D. æŠ½é¸æ©Ÿèƒ½
        // ------------------------------------
        
        // ãã˜å¼•ããƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’ãƒã‚§ãƒƒã‚¯
        function checkButtonState() {
            if (selectedMembers.length > 0) {
                BUTTON.disabled = false;
            } else {
                BUTTON.disabled = true;
            }
        }

        // æœ€çµ‚çµæœã®ç”»åƒå‡¦ç† (å½“é¸è€…)
        function updateResultImage(member) {
            RESULT_IMAGE.style.display = 'block';
            
            RESULT_IMAGE.onerror = null; // ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’ãƒªã‚»ãƒƒãƒˆ
            
            // â˜… ç”»åƒã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ã®è¨­å®š (GAS/PNG/JPG/00.pngã®é †ã«è©¦ã™) â˜…
            let errorCount = 0;
            RESULT_IMAGE.onerror = function() {
                errorCount++;

                if (errorCount === 1) {
                    this.src = member.image_jpg; 
                } else if (errorCount === 2) {
                    this.src = DEFAULT_IMAGE_PATH; 
                } else {
                    this.onerror = null; 
                }
            };
            
            // åˆæœŸã‚½ãƒ¼ã‚¹ã®è¨­å®šï¼ˆGAS/å¤–éƒ¨URLã‚’å„ªå…ˆã€ãªã‘ã‚Œã°GitHubã®.pngã‚’è©¦ã™ï¼‰
            RESULT_IMAGE.src = member.image_gas || member.image_png;
        }

        // ãã˜å¼•ãé–‹å§‹
        function startKujibiki() {
            if (BUTTON.disabled || selectedMembers.length === 0) return;
            
            BUTTON.disabled = true;
            RESULT_NAME.textContent = "ã‚·ãƒ£ãƒƒãƒ•ãƒ«ä¸­...";
            RESULT_IMAGE.style.display = 'none';

            let count = 0;
            
            // æŠ½é¸ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé«˜é€Ÿã§åå‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ï¼‰
            intervalId = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * selectedMembers.length);
                const currentMember = selectedMembers[randomIndex];
                
                RESULT_NAME.textContent = currentMember.nickname;
                
                count++;
                
                // 1.5ç§’å¾Œã«åœæ­¢
                if (count > 20) {
                    clearInterval(intervalId);
                    
                    // æœ€çµ‚çµæœã‚’æ±ºå®š
                    setTimeout(stopKujibiki, 500); 
                }
            }, 75); 
        }

        // ãã˜å¼•ãåœæ­¢ãƒ»çµæœè¡¨ç¤º
        function stopKujibiki() {
            const finalIndex = Math.floor(Math.random() * selectedMembers.length);
            const winner = selectedMembers[finalIndex];

            RESULT_NAME.textContent = 'ğŸ‰ ' + winner.nickname + ' ãŒå½“é¸ï¼ ğŸ‰';
            updateResultImage(winner); // å½“é¸è€…ã®ç”»åƒã‚’æ­£ã—ãè¡¨ç¤º
            
            // æŠ½é¸ãŒçµ‚ã‚ã£ãŸã‚‰ãƒœã‚¿ãƒ³ã‚’å†åº¦æœ‰åŠ¹ã«ã™ã‚‹
            BUTTON.disabled = false;
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€
        window.onload = loadMembersForKujibiki;

    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãã˜å¼•ã - UNIZON Softball Team</title>
    <link rel="stylesheet" href="style.css">
    
    <style>
        :root {
            --primary-color: #001f44;
            --secondary-color: #ffffff;
            --accent-color: #e74c3c;
            --selection-color: #f39c12; /* é¸æŠæ™‚ã®è‰² */
        }

        /* ãã˜å¼•ãå°‚ç”¨ã®CSS */
        #kujibiki-page {
            text-align: center;
        }
        
        /* 1. å•†å“ç”»åƒã‚¨ãƒªã‚¢ */
        #prize-area {
            border: 2px dashed #ccc;
            padding: 10px;
            margin: 20px auto;
            width: 90%;
            max-width: 300px;
            cursor: pointer;
            border-radius: 8px;
        }
        #prize-image {
            width: 100%;
            height: 150px;
            object-fit: contain; /* ç”»åƒå…¨ä½“ã‚’è¡¨ç¤º */
            border-radius: 4px;
            display: block;
            margin: 5px auto;
        }
        
        /* 2. å‚åŠ è€…é¸æŠã‚¨ãƒªã‚¢ */
        #member-selection-area {
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        #member-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            max-height: 250px;
            overflow-y: auto;
            padding: 5px;
            border-top: 1px solid #eee;
            margin-top: 10px;
        }
        .member-card {
            width: 65px;
            padding: 5px;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background-color: #f9f9f9;
        }
        .member-card.selected {
            border-color: var(--selection-color);
            background-color: #fffbe6;
            transform: scale(1.05);
        }
        .member-card img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 50%;
            display: block;
            margin: 0 auto;
        }
        .member-card p {
            font-size: 0.7rem;
            margin: 3px 0 0;
            font-weight: bold;
            color: var(--primary-color);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        
        /* 3. çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        #result-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 30px 0;
            min-height: 150px; /* çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’ç¢ºä¿ */
        }
        #result-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid var(--accent-color);
            margin-bottom: 10px;
            background-color: #ccc; 
            display: none; 
        }
        #result-name {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent-color);
            min-height: 50px;
        }
        
        /* 4. ãƒœã‚¿ãƒ³ */
        #kujibiki-button {
            padding: 15px 40px;
            font-size: 1.5rem;
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border-radius: 10px;
            transition: background-color 0.3s;
        }
        #kujibiki-button:hover:not(:disabled) {
            background-color: #003366;
        }
        #kujibiki-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    
    <header style="justify-content: flex-start;">
        <button class="menu-item" style="margin-right: 15px;" onclick="window.location.href='index.html'">
            ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
        </button>
        <h1>
            <span>ãã˜å¼•ãå¤§ä¼šï¼</span>
        </h1>
    </header>

    <main id="app">
        <section id="kujibiki-page" class="page active" style="display: flex; flex-direction: column; align-items: center;">
            
            <h2>ğŸ‰ å•†å“ã¨å‚åŠ è€…ã‚’è¨­å®š ğŸ‰</h2>
            
            <p id="loading-message">ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
            
            <h3>â‘  å•†å“ã®å†™çœŸã‚’é¸æŠ</h3>
            <div id="prize-area" onclick="document.getElementById('prizeInput').click()">
                <input type="file" id="prizeInput" accept="image/*" style="display:none;">
                <img id="prize-image" src="" alt="å•†å“ç”»åƒ" style="display: none;">
                <p id="prize-prompt">ã‚¿ãƒƒãƒ—ã—ã¦å•†å“å†™çœŸã‚’é¸ã¶ï¼ˆã‚«ãƒ¡ãƒ©/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰</p>
            </div>

            <h3>â‘¡ å‚åŠ è€…ã‚’ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆã‚¿ãƒƒãƒ—ã§é¸æŠï¼‰</h3>
            <div id="member-selection-area">
                <p>å‚åŠ ãƒ¡ãƒ³ãƒãƒ¼ï¼š<span id="selected-count">0</span>äºº</p>
                <div id="member-grid">
                    <p id="loading-members">ãƒ¡ãƒ³ãƒãƒ¼ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
            </div>
            
            <div id="result-container">
                <img id="result-image" src="" alt="å½“é¸è€…ç”»åƒ">
                <div id="result-name">---</div>
            </div>
            
            <button id="kujibiki-button" onclick="startKujibiki()" disabled>ãã˜ã‚’å¼•ãï¼</button>

            <p style="margin-top: 20px;">â€» å‚åŠ è€…ã‚’1äººä»¥ä¸Šé¸ã‚“ã§ãã ã•ã„ã€‚</p>

        </section>
    </main>

    <script>
        // --- ãã˜å¼•ãã®ãƒ­ã‚¸ãƒƒã‚¯ ---
        
        // â˜… ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã‚¢ãƒ—ãƒªã¨åŒã˜API URLã‚’è¨­å®š â˜…
        const API_URL = "https://script.google.com/macros/s/AKfycbzROz8hBY31FZB0cECHPXF6DJlX2t8t3rOAHaOBAfWE3M4jYiyw6u3TWG3N0WxPbGFM/exec";
        
        // â˜…â˜…â˜… GitHubã®ç”»åƒä¿å­˜ãƒ•ã‚©ãƒ«ãƒ€ã®URL â˜…â˜…â˜…
        const GITHUB_BASE_URL = "https://raw.githubusercontent.com/gomamiso-pro/unizon/main/images/member/";
        
        const DEFAULT_IMAGE_PATH = GITHUB_BASE_URL + '00.png';

        let membersData = []; // å…¨ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´
        let selectedMembers = []; // æŠ½é¸ã«å‚åŠ ã™ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ã‚’æ ¼ç´
        
        // DOMè¦ç´ ã®å–å¾—
        const RESULT_IMAGE = document.getElementById('result-image');
        const RESULT_NAME = document.getElementById('result-name');
        const BUTTON = document.getElementById('kujibiki-button');
        const LOADING_MESSAGE = document.getElementById('loading-message');
        const MEMBER_GRID = document.getElementById('member-grid');
        const SELECTED_COUNT = document.getElementById('selected-count');
        const PRIZE_INPUT = document.getElementById('prizeInput');
        const PRIZE_IMAGE = document.getElementById('prize-image');
        const PRIZE_PROMPT = document.getElementById('prize-prompt');
        
        let intervalId;

        // ------------------------------------
        // A. ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        // ------------------------------------

        // ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’éåŒæœŸã§èª­ã¿è¾¼ã‚€é–¢æ•°
        async function loadMembersForKujibiki() {
            LOADING_MESSAGE.textContent = "ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...";
            try {
                const res = await fetch(API_URL);
                const members = await res.json();

                if (Array.isArray(members) && members.length > 0) {
                    membersData = members.map(m => {
                        const memberNumber = String(m.number || '00').trim();
                        
                        // ç”»åƒãƒ‘ã‚¹ã‚’GitHub URLã«è¨­å®š
                        const imagePngUrl = GITHUB_BASE_URL + `${memberNumber}.png`;
                        const imageJpgUrl = GITHUB_BASE_URL + `${memberNumber}.jpg`;

                        return {
                            nickname: m.nickname,
                            // GASã‹ã‚‰æ¥ã‚‹ç”»åƒURLã‚’æœ€å„ªå…ˆ
                            image_gas: m.image,
                            // GitHubãƒ‘ã‚¹ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
                            image_png: imagePngUrl,
                            image_jpg: imageJpgUrl,
                            number: memberNumber
                        };
                    });
                    
                    displayMemberSelection(); // ãƒ¡ãƒ³ãƒãƒ¼é¸æŠã‚°ãƒªãƒƒãƒ‰ã‚’è¡¨ç¤º
                    LOADING_MESSAGE.textContent = ""; 
                    
                } else {
                    LOADING_MESSAGE.textContent = "ã‚¨ãƒ©ãƒ¼: ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã›ã‚“ã€‚";
                }
            } catch (err) {
                LOADING_MESSAGE.textContent = "ã‚¨ãƒ©ãƒ¼: ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
                console.error("ãƒ¡ãƒ³ãƒãƒ¼å–å¾—é€šä¿¡ã‚¨ãƒ©ãƒ¼:", err);
            }
        }
        
        // ------------------------------------
        // B. ãƒ¡ãƒ³ãƒãƒ¼é¸æŠæ©Ÿèƒ½
        // ------------------------------------

        // ãƒ¡ãƒ³ãƒãƒ¼é¸æŠã‚°ãƒªãƒƒãƒ‰ã‚’DOMã«è¡¨ç¤º
        function displayMemberSelection() {
            MEMBER_GRID.innerHTML = '';
            
            membersData.forEach(member => {
                const card = document.createElement('div');
                card.className = 'member-card';
                card.dataset.number = member.number;
                
                // ç”»åƒè¦ç´ ã®ç”Ÿæˆ
                const img = document.createElement('img');
                img.alt = member.nickname;
                
                // â˜… ç”»åƒã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ã®è¨­å®š (GAS/PNG/JPG/00.pngã®é †ã«è©¦ã™) â˜…
                let errorCount = 0;
                img.onerror = function() {
                    errorCount++;
                    
                    if (errorCount === 1) {
                        // 1å›ç›®ã‚¨ãƒ©ãƒ¼: GASã®URL ã¾ãŸã¯ .png ãŒå¤±æ•—
                        // æ¬¡ã« .jpg ã‚’è©¦ã™
                        this.src = member.image_jpg; 
                    } else if (errorCount === 2) {
                        // 2å›ç›®ã‚¨ãƒ©ãƒ¼: .jpg ã‚‚å¤±æ•—
                        this.src = DEFAULT_IMAGE_PATH; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 00.png ã‚’è©¦ã™
                    } else {
                        // 3å›ç›®ä»¥é™ã®ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–
                        this.onerror = null; 
                    }
                };

                // åˆæœŸã‚½ãƒ¼ã‚¹ã®è¨­å®šï¼ˆGAS/å¤–éƒ¨URLã‚’å„ªå…ˆã€ãªã‘ã‚Œã°GitHubã®.pngã‚’è©¦ã™ï¼‰
                img.src = member.image_gas || member.image_png;

                card.appendChild(img);
                
                const p = document.createElement('p');
                p.textContent = member.nickname;
                card.appendChild(p);

                // ã‚¿ãƒƒãƒ—ã§é¸æŠ/è§£é™¤
                card.addEventListener('click', () => toggleMemberSelection(member, card));
                
                MEMBER_GRID.appendChild(card);
            });
            
            const loadingMsgElement = document.getElementById('loading-members');
            if(loadingMsgElement) loadingMsgElement.style.display = 'none'; 
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ã®é¸æŠ/è§£é™¤
        function toggleMemberSelection(member, cardElement) {
            const index = selectedMembers.findIndex(m => m.number === member.number);
            
            if (index === -1) {
                selectedMembers.push(member);
                cardElement.classList.add('selected');
            } else {
                selectedMembers.splice(index, 1);
                cardElement.classList.remove('selected');
            }

            SELECTED_COUNT.textContent = selectedMembers.length;
            checkButtonState();
        }
        
        // ------------------------------------
        // C. å•†å“ç”»åƒæ©Ÿèƒ½
        // ------------------------------------
        
        PRIZE_INPUT.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    PRIZE_IMAGE.src = e.target.result;
                    PRIZE_IMAGE.style.display = 'block';
                    PRIZE_PROMPT.textContent = 'å•†å“ç”»åƒã‚’è¨­å®šã—ã¾ã—ãŸ';
                };
                reader.readAsDataURL(file);
            } else {
                PRIZE_IMAGE.style.display = 'none';
                PRIZE_PROMPT.textContent = 'ã‚¿ãƒƒãƒ—ã—ã¦å•†å“å†™çœŸã‚’é¸ã¶ï¼ˆã‚«ãƒ¡ãƒ©/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰';
            }
        });

        // ------------------------------------
        // D. æŠ½é¸æ©Ÿèƒ½
        // ------------------------------------
        
        // ãã˜å¼•ããƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’ãƒã‚§ãƒƒã‚¯
        function checkButtonState() {
            if (selectedMembers.length > 0) {
                BUTTON.disabled = false;
            } else {
                BUTTON.disabled = true;
            }
        }

        // æœ€çµ‚çµæœã®ç”»åƒå‡¦ç† (å½“é¸è€…)
        function updateResultImage(member) {
            RESULT_IMAGE.style.display = 'block';
            
            RESULT_IMAGE.onerror = null; // ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’ãƒªã‚»ãƒƒãƒˆ
            
            // â˜… ç”»åƒã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ã®è¨­å®š (GAS/PNG/JPG/00.pngã®é †ã«è©¦ã™) â˜…
            let errorCount = 0;
            RESULT_IMAGE.onerror = function() {
                errorCount++;

                if (errorCount === 1) {
                    this.src = member.image_jpg; 
                } else if (errorCount === 2) {
                    this.src = DEFAULT_IMAGE_PATH; 
                } else {
                    this.onerror = null; 
                }
            };
            
            // åˆæœŸã‚½ãƒ¼ã‚¹ã®è¨­å®šï¼ˆGAS/å¤–éƒ¨URLã‚’å„ªå…ˆã€ãªã‘ã‚Œã°GitHubã®.pngã‚’è©¦ã™ï¼‰
            RESULT_IMAGE.src = member.image_gas || member.image_png;
        }

        // ãã˜å¼•ãé–‹å§‹
        function startKujibiki() {
            if (BUTTON.disabled || selectedMembers.length === 0) return;
            
            BUTTON.disabled = true;
            RESULT_NAME.textContent = "ã‚·ãƒ£ãƒƒãƒ•ãƒ«ä¸­...";
            RESULT_IMAGE.style.display = 'none';

            let count = 0;
            
            // æŠ½é¸ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé«˜é€Ÿã§åå‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ï¼‰
            intervalId = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * selectedMembers.length);
                const currentMember = selectedMembers[randomIndex];
                
                RESULT_NAME.textContent = currentMember.nickname;
                
                count++;
                
                // 1.5ç§’å¾Œã«åœæ­¢
                if (count > 20) {
                    clearInterval(intervalId);
                    
                    // æœ€çµ‚çµæœã‚’æ±ºå®š
                    setTimeout(stopKujibiki, 500); 
                }
            }, 75); 
        }

        // ãã˜å¼•ãåœæ­¢ãƒ»çµæœè¡¨ç¤º
        function stopKujibiki() {
            const finalIndex = Math.floor(Math.random() * selectedMembers.length);
            const winner = selectedMembers[finalIndex];

            RESULT_NAME.textContent = 'ğŸ‰ ' + winner.nickname + ' ãŒå½“é¸ï¼ ğŸ‰';
            updateResultImage(winner); // å½“é¸è€…ã®ç”»åƒã‚’æ­£ã—ãè¡¨ç¤º
            
            // æŠ½é¸ãŒçµ‚ã‚ã£ãŸã‚‰ãƒœã‚¿ãƒ³ã‚’å†åº¦æœ‰åŠ¹ã«ã™ã‚‹
            BUTTON.disabled = false;
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€
        window.onload = loadMembersForKujibiki;

    </script>
</body>
</html>
