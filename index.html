<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNISON Softball Team</title>
<style>
/* 簡略化 */
body { font-family: sans-serif; background:#f5f8ff; margin:0; padding:0; color:#003366; }
header, footer { padding:10px; background:#b3d1ff; text-align:center;}
main { padding:20px; max-width:600px; margin:0 auto;}
.page { display:none; }
.active { display:block; }
img.member-img { width:60px; height:60px; border-radius:50%; }
</style>
</head>
<body>

<header>
<h1>UNISON Softball Team</h1>
<nav>
  <button onclick="showPage('home')">ホーム</button>
  <button onclick="showPage('members')">メンバー一覧</button>
  <button onclick="showPage('register')">メンバー登録</button>
</nav>
</header>

<main>
<div id="home" class="page active">
  <p>ようこそ！UNISONソフトボールチームの公式ページへ。</p>
</div>

<div id="members" class="page">
  <h2>メンバー一覧</h2>
  <table border="1" width="100%">
    <thead><tr><th>番号</th><th>ニックネーム</th><th>ポジション</th><th>画像</th></tr></thead>
    <tbody id="memberTable"></tbody>
  </table>
</div>

<div id="register" class="page">
  <h2>メンバー登録</h2>
  <form id="registerForm">
    <label>番号:<input type="number" name="number" required></label>
    <label>ニックネーム:<input type="text" name="nickname" required></label>
    <label>ポジション:<input type="text" name="position" required></label>
    <label>画像:<input type="file" id="fileInput" accept="image/*" required></label>
    <button type="submit">登録</button>
  </form>
</div>
</main>

<footer>&copy; 2025 UNISON Softball Team</footer>

<script>
const API_URL = "<<<GAS WebアプリURL>>>";

function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// メンバー一覧取得
async function loadMembers(){
  try{
    const res = await fetch(API_URL);
    const members = await res.json();
    const tbody = document.getElementById("memberTable");
    tbody.innerHTML = "";
    members.forEach(m=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${m.number}</td>
        <td>${m.nickname}</td>
        <td>${m.position}</td>
        <td>${m.image ? `<img src="${m.image}" class="member-img">` : ""}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch(err){
    console.error("メンバー取得エラー:", err);
  }
}

// 登録フォーム送信
document.getElementById("registerForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const number = e.target.number.value;
  const nickname = e.target.nickname.value;
  const position = e.target.position.value;
  const file = document.getElementById("fileInput").files[0];

  // ファイルをBase64に変換
  const reader = new FileReader();
  reader.onload = async function(){
    const base64Data = reader.result.split(",")[1]; // "data:image/png;base64,..." を取り除く
    const formData = new FormData();
    formData.append("number", number);
    formData.append("nickname", nickname);
    formData.append("position", position);
    formData.append("fileData", base64Data);
    formData.append("fileName", file.name);

    try{
      const res = await fetch(API_URL, {method:"POST", body:formData});
      const text = await res.text();
      alert(text);
      e.target.reset();
      showPage('members');
      loadMembers();
    } catch(err){
      alert("登録エラー: "+err);
    }
  };
  reader.readAsDataURL(file);
});

// 初回一覧取得
loadMembers();
</script>

</body>
</html>
