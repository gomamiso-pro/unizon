<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNISON Softball Team</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: #f5f8ff;
  margin: 0;
  padding: 0;
  color: #003366;
}
header, footer {
  padding: 12px;
  background: #4d88ff;
  text-align: center;
  color: white;
}
header h1 { margin: 0; }
nav { margin-top: 8px; }
nav button {
  margin: 0 5px;
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  background: white;
  color: #4d88ff;
  cursor: pointer;
  font-weight: bold;
}
nav button:hover { background: #e6f0ff; }
main {
  padding: 20px;
  max-width: 700px;
  margin: 20px auto;
}
.page { display: none; }
.active { display: block; }
table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  border-radius: 8px;
  overflow: hidden;
}
table th, table td { padding: 10px; text-align: center; }
table thead { background: #cce0ff; }
img.member-img {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
}
/* --- フォームデザイン --- */
form {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
}
form label {
  display: block;
  margin-bottom: 15px;
  font-weight: bold;
}
form input {
  width: 100%;
  padding: 8px;
  margin-top: 4px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
}
form button {
  margin-top: 15px;
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 8px;
  background: #4d88ff;
  color: white;
  font-size: 16px;
  cursor: pointer;
  font-weight: bold;
}
form button:hover { background: #3366cc; }
</style>
</head>
<body>

<header>
  <h1>UNISON Softball Team</h1>
  <nav>
    <button onclick="showPage('home')">ホーム</button>
    <button onclick="showPage('members')">メンバー一覧</button>
    <button onclick="showPage('register')">メンバー登録</button>
  </nav>
</header>

<main>
  <div id="home" class="page active">
    <p>ようこそ！UNISONソフトボールチームの公式ページへ。</p>
  </div>

  <div id="members" class="page">
    <h2>メンバー一覧</h2>
    <table>
      <thead><tr><th>番号</th><th>ニックネーム</th><th>ポジション</th><th>画像</th></tr></thead>
      <tbody id="memberTable"></tbody>
    </table>
  </div>

  <div id="register" class="page">
    <h2>メンバー登録</h2>
    <form id="registerForm">
      <label>番号:
        <input type="number" name="number" required>
      </label>
      <label>ニックネーム:
        <input type="text" name="nickname" required>
      </label>
      <label>ポジション:
        <input type="text" name="position" required>
      </label>
      <label>画像:
        <input type="file" id="fileInput" accept="image/*" required>
      </label>
      <button type="submit">登録</button>
    </form>
  </div>
</main>

<footer>&copy; 2025 UNISON Softball Team29</footer>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzpLI_z6kMGVecx2Fl9gcLWGme9aVkDoff2FA7zFyNbTEBOFvkav9oai2MeGhrjrJ1n/exec";

function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// メンバー一覧取得
async function loadMembers(){
  try{
    const res = await fetch(API_URL);
    const members = await res.json();
    const tbody = document.getElementById("memberTable");
    tbody.innerHTML = "";
    members.forEach(m=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${m.number}</td>
        <td>${m.nickname}</td>
        <td>${m.position}</td>
        <td>${m.image ? `<img src="${m.image}" class="member-img" referrerpolicy="no-referrer">` : ""}</td>
        <!-- ↑ 403対策：referrerpolicy="no-referrer" を追加 -->
      `;
      tbody.appendChild(tr);
    });
  } catch(err){
    console.error("メンバー取得エラー:", err);
  }
}

// 登録フォーム送信
document.getElementById("registerForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const number = e.target.number.value;
  const nickname = e.target.nickname.value;
  const position = e.target.position.value;
  const file = document.getElementById("fileInput").files[0];

  const reader = new FileReader();
  reader.onload = async function(){
    const base64Data = reader.result.split(",")[1];
    const formData = new FormData();
    formData.append("number", number);
    formData.append("nickname", nickname);
    formData.append("position", position);
    formData.append("fileData", base64Data);
    formData.append("fileName", file.name);
    formData.append("fileType", file.type); // ← MIMEタイプも送信

    try{
      const res = await fetch(API_URL, {method:"POST", body:formData});
      const text = await res.text();
      alert(text);
      e.target.reset();
      showPage('members');
      loadMembers();
    } catch(err){
      alert("登録エラー: "+err);
    }
  };
  reader.readAsDataURL(file);
});

// 初回一覧取得
loadMembers();
</script>

</body>
</html>
